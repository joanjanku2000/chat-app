CREATE PROCEDURE [dbo].[GROUPS_OF_USER] @Userid bigint AS
BEGIN
				select  distinct (groupp.id) , max(groupp.name) , max(groupp.admin_id) , max(user_group.id), max(user_group.group_id) , max(user_group.user_id)   
				from groupp 
					left join user_group on user_group.group_id = groupp.id 
				where (admin_id = @Userid ) or (user_group.user_id = @Userid) 
					group  by groupp.id ;
END;

CREATE PROCEDURE [dbo].[MESSAGES_OF_GROUP] @Groupid bigint AS
BEGIN
		select * from group_message where group_message.group_id = @Groupid
END;


CREATE PROCEDURE [dbo].[USERS_OF_GROUP] @Groupid bigint AS
BEGIN
		select userr.id as user_id 
		, userr.namee as user_name, userr.last_name as last_name 
		, userr.phone_number as phone_number, userr.online as online 
		, groupp.id as group_id 
		, groupp.name as group_name from user_group 
		inner join userr on userr.id = user_group.user_id
		inner join groupp on user_group.group_id = groupp.id
		where user_group.group_id = @Groupid;
END;

create procedure GROUPS_MOST_INTERACTED_WITH @Userid bigint  AS
BEGIN
				select top 5 group_message.group_id as group_id,  count(*) as total_messages
						from dbo.group_message 
						where group_message.sender_id = @Userid 
						group by group_message.group_id 
						order by total_messages desc;
END;

create procedure RECEIVED_MOST_MESSAGES_FROM @Userid bigint  AS
BEGIN
				select top 5 user_message.sender_id as sender,  count(*) as total_messages
					from dbo.user_message 
					where user_message.receiver_id = @Userid 
					group by user_message.sender_id 
					order by total_messages desc;
END;

create procedure SENT_MOST_MESSAGES @Userid bigint  AS
BEGIN
	select top 5 user_message.receiver_id as receiver,  count(*) as total_messages
	
	from dbo.user_message 
				where user_message.sender_id = @Userid
			group by user_message.receiver_id 
		order by total_messages desc;
END;
